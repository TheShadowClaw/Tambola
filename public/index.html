<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambola Office Edition - Remote Team Gaming</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
            padding: 50px 20px;
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.3em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .header .description {
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto 40px;
            opacity: 0.8;
            line-height: 1.6;
        }

        .role-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }

        .role-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .role-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .role-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .role-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }

        .role-card h2 {
            color: #333;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .role-description {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .role-features {
            list-style: none;
            margin-bottom: 30px;
            text-align: left;
        }

        .role-features li {
            padding: 8px 0;
            color: #555;
            position: relative;
            padding-left: 25px;
        }

        .role-features li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .features-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 50px 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .feature-card {
            text-align: center;
            padding: 20px;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .feature-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-card p {
            color: #666;
            line-height: 1.5;
        }

        .game-interface {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .back-btn {
            background: #6c757d;
            margin-bottom: 20px;
        }

        .join-form {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            text-align: left;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .host-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-card h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .called-numbers {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .number-cell {
            width: 35px;
            height: 35px;
            border: 2px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .number-called {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .ticket-cell {
            width: 50px;
            height: 50px;
            border: 2px solid #ddd;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .ticket-cell.marked {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .ticket-cell.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .ticket-cell.empty {
            background: #6c757d;
            cursor: default;
        }

        .win-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .win-btn {
            padding: 10px 20px;
            font-size: 0.9em;
        }

        .win-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .role-selection {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .role-card {
                padding: 30px 20px;
            }
            
            .features-section {
                padding: 30px 20px;
            }

            .numbers-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            .win-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Tambola Office Edition</h1>
            <div class="subtitle">Remote Team Gaming Platform</div>
            <div class="description">
                Bring your team together with the classic game of Tambola (Housie)! 
                Perfect for office parties, team building, and remote celebrations. 
                Up to 50 players can join from anywhere in the world.
            </div>
        </div>

        <!-- Role Selection Screen -->
        <div id="roleSelection">
            <div class="role-selection">
                <div class="role-card" onclick="showHostInterface()">
                    <span class="role-icon">🎮</span>
                    <h2>Game Host</h2>
                    <div class="role-description">
                        Take control as the game master. Call numbers, manage the game, 
                        and celebrate with your team when they win!
                    </div>
                    <ul class="role-features">
                        <li>Start and manage games</li>
                        <li>Call numbers with one click</li>
                        <li>Track all winners in real-time</li>
                        <li>Monitor player connections</li>
                        <li>Reset games as needed</li>
                    </ul>
                    <div class="btn">Host a Game</div>
                </div>

                <div class="role-card" onclick="showPlayerInterface()">
                    <span class="role-icon">🎯</span>
                    <h2>Player</h2>
                    <div class="role-description">
                        Join the fun! Get your tambola ticket and play along. 
                        Works perfectly on mobile devices and computers.
                    </div>
                    <ul class="role-features">
                        <li>Auto-generated tambola tickets</li>
                        <li>Easy number marking system</li>
                        <li>Claim wins instantly</li>
                        <li>Real-time game updates</li>
                        <li>Mobile-friendly interface</li>
                    </ul>
                    <div class="btn">Join as Player</div>
                </div>
            </div>

            <div class="features-section">
                <h2 style="text-align: center; color: #333; margin-bottom: 20px;">Game Features</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <span class="feature-icon">🏠</span>
                        <h3>All Classic Patterns</h3>
                        <p>Early Five, Lines, Four Corners, and Full House - all the traditional Tambola winning patterns</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">⚡</span>
                        <h3>Real-time Gameplay</h3>
                        <p>Instant number calling, automatic ticket marking, and live winner announcements</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">📱</span>
                        <h3>Multi-device Support</h3>
                        <p>Play on phones, tablets, or computers - responsive design works everywhere</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">👥</span>
                        <h3>Team Building</h3>
                        <p>Perfect for office parties, virtual team events, and remote team bonding</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Host Interface -->
        <div id="hostInterface" class="game-interface">
            <button class="btn back-btn" onclick="showRoleSelection()">← Back to Home</button>
            <h2 style="text-align: center; margin-bottom: 30px;">🎮 Host Control Panel</h2>
            
            <div class="host-controls">
                <button id="startButton" class="btn" onclick="startGame()">Start Game</button>
                <button id="callButton" class="btn" onclick="callNumber()" disabled>Call Number</button>
                <button id="resetButton" class="btn" onclick="resetGame()">Reset Game</button>
            </div>

            <div id="currentNumber" style="text-align: center; font-size: 3em; color: #667eea; margin: 20px 0;">
                Ready to Start
            </div>

            <div class="game-stats">
                <div class="stat-card">
                    <h4>Connected Players</h4>
                    <div id="playerCount" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <h4>Numbers Called</h4>
                    <div id="numbersCalledCount" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <h4>Numbers Remaining</h4>
                    <div id="numbersRemaining" class="stat-value">90</div>
                </div>
                <div class="stat-card">
                    <h4>Game Status</h4>
                    <div id="gameStatus" class="stat-value">Waiting</div>
                </div>
            </div>

            <div class="called-numbers">
                <h3>📋 Called Numbers</h3>
                <div id="calledNumbersGrid" class="numbers-grid">
                    <!-- Numbers 1-90 will be populated here -->
                </div>
            </div>

            <div id="winners" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                <h3>🏆 Winners</h3>
                <div id="winnersList">No winners yet</div>
            </div>
        </div>

        <!-- Player Interface -->
        <div id="playerInterface" class="game-interface">
            <button class="btn back-btn" onclick="showRoleSelection()">← Back to Home</button>
            <h2 style="text-align: center; margin-bottom: 30px;">🎯 Join the Game</h2>
            
            <div class="join-form">
                <div class="input-group">
                    <label for="playerName">Your Name:</label>
                    <input type="text" id="playerName" placeholder="Enter your name" maxlength="20" required>
                </div>
                <button class="btn" onclick="joinGame()">Join Game</button>
            </div>

            <div id="gameArea" style="display: none; margin-top: 30px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>Game Status: <span id="playerGameStatus">Joined</span></h3>
                    <div id="playerCurrentNumber" style="font-size: 2em; color: #667eea; margin: 10px 0;">
                        Waiting for game to start...
                    </div>
                </div>

                <div id="alerts"></div>

                <div id="ticket" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <!-- Ticket will be generated here -->
                </div>

                <div class="win-buttons">
                    <button class="btn win-btn" id="earlyFiveBtn" onclick="claimWin('earlyFive')" disabled>Early Five</button>
                    <button class="btn win-btn" id="topLineBtn" onclick="claimWin('topLine')" disabled>Top Line</button>
                    <button class="btn win-btn" id="middleLineBtn" onclick="claimWin('middleLine')" disabled>Middle Line</button>
                    <button class="btn win-btn" id="bottomLineBtn" onclick="claimWin('bottomLine')" disabled>Bottom Line</button>
                    <button class="btn win-btn" id="cornersBtn" onclick="claimWin('corners')" disabled>Four Corners</button>
                    <button class="btn win-btn" id="fullHouseBtn" onclick="claimWin('fullHouse')" disabled>Full House</button>
                </div>

                <div style="text-align: center; margin-top: 20px; color: #666;">
                    <small>You can only mark numbers that have been called and claim wins when you have the correct pattern!</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentRole = null;
        let gameActive = false;
        let currentTicket = [];
        let markedNumbers = [];
        let calledNumbers = [];
        let playerName = '';
        let claimedWins = [];

        // Navigation functions
        function showRoleSelection() {
            document.getElementById('roleSelection').style.display = 'block';
            document.getElementById('hostInterface').style.display = 'none';
            document.getElementById('playerInterface').style.display = 'none';
            currentRole = null;
            resetGameState();
        }

        function showHostInterface() {
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('hostInterface').style.display = 'block';
            document.getElementById('playerInterface').style.display = 'none';
            currentRole = 'host';
            initializeCalledNumbersGrid();
        }

        function showPlayerInterface() {
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('hostInterface').style.display = 'none';
            document.getElementById('playerInterface').style.display = 'block';
            currentRole = 'player';
        }

        function resetGameState() {
            gameActive = false;
            markedNumbers = [];
            calledNumbers = [];
            claimedWins = [];
        }

        // Initialize called numbers grid for host
        function initializeCalledNumbersGrid() {
            const grid = document.getElementById('calledNumbersGrid');
            grid.innerHTML = '';
            for (let i = 1; i <= 90; i++) {
                const cell = document.createElement('div');
                cell.className = 'number-cell';
                cell.textContent = i;
                cell.id = `called-${i}`;
                grid.appendChild(cell);
            }
        }

        // Host functions
        function startGame() {
            socket.emit('startGame');
        }

        function callNumber() {
            if (!gameActive) return;
            socket.emit('callNumber');
        }

        function resetGame() {
            socket.emit('resetGame');
            resetGameState();
            if (currentRole === 'host') {
                initializeCalledNumbersGrid();
            }
        }

        // Player functions
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showAlert('Please enter your name', 'error');
                return;
            }
            playerName = name;
            socket.emit('joinGame', name);
        }

        function generateTicket() {
            const ticket = [];
            for (let row = 0; row < 3; row++) {
                const ticketRow = [];
                const usedInRow = new Set();
                
                // Generate 5 numbers per row with 4 empty cells
                let numbersInRow = 0;
                for (let col = 0; col < 9; col++) {
                    if (numbersInRow < 5 && Math.random() < 0.6) {
                        // Generate number for this column range
                        const min = col * 10 + (col === 0 ? 1 : 0);
                        const max = col * 10 + 9;
                        let number;
                        do {
                            number = Math.floor(Math.random() * (max - min + 1)) + min;
                        } while (usedInRow.has(number));
                        
                        usedInRow.add(number);
                        ticketRow.push(number);
                        numbersInRow++;
                    } else {
                        ticketRow.push(0); // Empty cell
                    }
                }
                
                // Ensure exactly 5 numbers per row
                while (numbersInRow < 5) {
                    const emptyIndex = ticketRow.findIndex(val => val === 0);
                    if (emptyIndex !== -1) {
                        const col = emptyIndex;
                        const min = col * 10 + (col === 0 ? 1 : 0);
                        const max = col * 10 + 9;
                        let number;
                        do {
                            number = Math.floor(Math.random() * (max - min + 1)) + min;
                        } while (usedInRow.has(number));
                        
                        usedInRow.add(number);
                        ticketRow[emptyIndex] = number;
                        numbersInRow++;
                    }
                }
                
                ticket.push(ticketRow);
            }
            return ticket;
        }

        function displayTicket(ticket) {
            currentTicket = ticket;
            const ticketElement = document.getElementById('ticket');
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            
            for (let row = 0; row < 3; row++) {
                html += '<tr>';
                for (let col = 0; col < 9; col++) {
                    const number = ticket[row][col];
                    const cellId = `cell-${row}-${col}`;
                    
                    if (number === 0) {
                        html += '<td class="ticket-cell empty"></td>';
                    } else {
                        html += `<td class="ticket-cell" id="${cellId}" data-number="${number}" onclick="markNumber(${number})">${number}</td>`;
                    }
                }
                html += '</tr>';
            }
            html += '</table>';
            ticketElement.innerHTML = html;
        }

        function markNumber(number) {
            // Only allow marking if the number has been called
            if (!calledNumbers.includes(number)) {
                showAlert(`Number ${number} has not been called yet!`, 'error');
                return;
            }

            if (markedNumbers.includes(number)) {
                return; // Already marked
            }

            markedNumbers.push(number);
            
            // Mark the number on the ticket
            const cells = document.querySelectorAll(`td[data-number="${number}"]`);
            cells.forEach(cell => {
                cell.classList.add('marked');
            });

            // Update win button states
            updateWinButtons();
            
            // Notify server
            socket.emit('markNumber', number);
        }

        function updateWinButtons() {
            // Enable/disable win buttons based on current marks
            document.getElementById('earlyFiveBtn').disabled = !canClaimEarlyFive();
            document.getElementById('topLineBtn').disabled = !canClaimLine(0) || claimedWins.includes('topLine');
            document.getElementById('middleLineBtn').disabled = !canClaimLine(1) || claimedWins.includes('middleLine');
            document.getElementById('bottomLineBtn').disabled = !canClaimLine(2) || claimedWins.includes('bottomLine');
            document.getElementById('cornersBtn').disabled = !canClaimCorners() || claimedWins.includes('corners');
            document.getElementById('fullHouseBtn').disabled = !canClaimFullHouse() || claimedWins.includes('fullHouse');
        }

        function canClaimEarlyFive() {
            return markedNumbers.length >= 5 && !claimedWins.includes('earlyFive');
        }

        function canClaimLine(rowIndex) {
            let markedInRow = 0;
            for (let col = 0; col < 9; col++) {
                const number = currentTicket[rowIndex][col];
                if (number !== 0 && markedNumbers.includes(number)) {
                    markedInRow++;
                }
            }
            return markedInRow === 5;
        }

        function canClaimCorners() {
            const corners = [
                currentTicket[0].find(n => n !== 0), // First non-zero in top row
                currentTicket[0][currentTicket[0].lastIndexOf(currentTicket[0].slice().reverse().find(n => n !== 0))], // Last non-zero in top row
                currentTicket[2].find(n => n !== 0), // First non-zero in bottom row
                currentTicket[2][currentTicket[2].lastIndexOf(currentTicket[2].slice().reverse().find(n => n !== 0))] // Last non-zero in bottom row
            ];
            
            return corners.every(corner => corner && markedNumbers.includes(corner));
        }

        function canClaimFullHouse() {
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 9; col++) {
                    const number = currentTicket[row][col];
                    if (number !== 0 && !markedNumbers.includes(number)) {
                        return false;
                    }
                }
            }
            return true;
        }

        function claimWin(pattern) {
            if (!gameActive) {
                showAlert('Game is not active!', 'error');
                return;
            }

            let canClaim = false;
            switch (pattern) {
                case 'earlyFive':
                    canClaim = canClaimEarlyFive();
                    break;
                case 'topLine':
                    canClaim = canClaimLine(0);
                    break;
                case 'middleLine':
                    canClaim = canClaimLine(1);
                    break;
                case 'bottomLine':
                    canClaim = canClaimLine(2);
                    break;
                case 'corners':
                    canClaim = canClaimCorners();
                    break;
                case 'fullHouse':
                    canClaim = canClaimFullHouse();
                    break;
            }

            if (!canClaim) {
                showAlert(`You cannot claim ${pattern} yet!`, 'error');
                return;
            }

            if (claimedWins.includes(pattern)) {
                showAlert(`You have already claimed ${pattern}!`, 'error');
                return;
            }

            socket.emit('claimWin', { pattern, markedNumbers });
        }

        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertsContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Socket event handlers
        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('playerCount', (count) => {
            document.getElementById('playerCount').textContent = count;
        });

        socket.on('gameStarted', (data) => {
            gameActive = true;
            calledNumbers = data.calledNumbers || [];
            
            if (currentRole === 'host') {
                document.getElementById('gameStatus').textContent = 'Active';
                document.getElementById('startButton').disabled = true;
                document.getElementById('callButton').disabled = false;
                document.getElementById('currentNumber').textContent = 'Game Started';
            } else if (currentRole === 'player') {
                document.getElementById('playerGameStatus').textContent = 'Game Active';
                updateWinButtons();
            }
        });

        socket.on('numberCalled', (data) => {
            const { number, calledNumbers: allCalled } = data;
            calledNumbers = allCalled;
            
            if (currentRole === 'host') {
                document.getElementById('currentNumber').textContent = `${number}`;
                document.getElementById('numbersCalledCount').textContent = allCalled.length;
                document.getElementById('numbersRemaining').textContent = 90 - allCalled.length;
                
                // Update called numbers grid
                const calledCell = document.getElementById(`called-${number}`);
                if (calledCell) {
                    calledCell.classList.add('number-called');
                }
                
                if (allCalled.length === 90) {
                    document.getElementById('callButton').disabled = true;
                    document.getElementById('gameStatus').textContent = 'Complete';
                }
            } else if (currentRole === 'player') {
                document.getElementById('playerCurrentNumber').textContent = `Last Called: ${number}`;
                updateWinButtons();
            }
        });

        socket.on('ticketGenerated', (ticket) => {
            displayTicket(ticket);
            document.getElementById('gameArea').style.display = 'block';
        });

        socket.on('gameJoined', () => {
            const ticket = generateTicket();
            displayTicket(ticket);
            document.getElementById('gameArea').style.display = 'block';
            showAlert('Successfully joined the game!', 'success');
        });

        socket.on('winnerAnnounced', (data) => {
            const { pattern, winner } = data;
            if (currentRole === 'host') {
                const winnersList = document.getElementById('winnersList');
                if (winnersList.textContent === 'No winners yet') {
                    winnersList.innerHTML = '';
                }
                winnersList.innerHTML += `<div style="margin: 5px 0; padding: 10px; background: #28a745; color: white; border-radius: 5px;">🎉 ${winner} won ${getPatternDisplayName(pattern)}!</div>`;
            } else if (currentRole === 'player') {
                if (winner === playerName) {
                    showAlert(`🎉 Congratulations! You won ${getPatternDisplayName(pattern)}!`, 'success');
                    claimedWins.push(pattern);
                    updateWinButtons();
                } else {
                    showAlert(`${winner} won ${getPatternDisplayName(pattern)}!`, 'success');
                }
            }
        });

        socket.on('winClaimed', (data) => {
            if (data.success) {
                claimedWins.push(data.pattern);
                updateWinButtons();
                showAlert(`Win confirmed for ${getPatternDisplayName(data.pattern)}!`, 'success');
            } else {
                showAlert(`Invalid win claim for ${getPatternDisplayName(data.pattern)}!`, 'error');
            }
        });

        socket.on('gameReset', () => {
            resetGameState();
            
            if (currentRole === 'host') {
                document.getElementById('gameStatus').textContent = 'Waiting';
                document.getElementById('startButton').disabled = false;
                document.getElementById('callButton').disabled = true;
                document.getElementById('currentNumber').textContent = 'Ready to Start';
                document.getElementById('numbersCalledCount').textContent = '0';
                document.getElementById('numbersRemaining').textContent = '90';
                document.getElementById('winnersList').textContent = 'No winners yet';
                initializeCalledNumbersGrid();
            } else if (currentRole === 'player') {
                document.getElementById('playerGameStatus').textContent = 'Game Reset';
                document.getElementById('playerCurrentNumber').textContent = 'Waiting for game to start...';
                
                // Reset ticket markings
                const cells = document.querySelectorAll('.ticket-cell');
                cells.forEach(cell => {
                    cell.classList.remove('marked');
                });
                
                updateWinButtons();
                document.getElementById('alerts').innerHTML = '';
            }
        });

        socket.on('error', (message) => {
            showAlert(message, 'error');
        });

        function getPatternDisplayName(pattern) {
            const patterns = {
                'earlyFive': 'Early Five',
                'topLine': 'Top Line',
                'middleLine': 'Middle Line',
                'bottomLine': 'Bottom Line',
                'corners': 'Four Corners',
                'fullHouse': 'Full House'
            };
            return patterns[pattern] || pattern;
        }

        // Initialize
        showRoleSelection();
    </script>
</body>
</html>
